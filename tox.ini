[tox]
envlist = py38, py39, py310, py311, py312, format, test
skipsdist = True
skip_missing_interpreters = True

[testenv:test]
description = Run tests with coverage
deps =
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m unittest discover -s tests -p "test_*.py"
    coverage report -m --include="ludo_engine/*" --omit="*/test_*"
    coverage html --include="ludo_engine/*" --omit="*/test_*"
    coverage xml --include="ludo_engine/*" --omit="*/test_*"

[testenv:test-ci]
description = Run tests with coverage for CI (no HTML report)
deps =
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m unittest discover -s tests -p "test_*.py"
    coverage report -m --include="ludo_engine/*" --omit="*/test_*" --fail-under=80
    coverage xml --include="ludo_engine/*" --omit="*/test_*"

[testenv:format]
description = Format code with black and ruff
deps =
    black>=23.0,<25.0
    ruff>=0.1.0
    isort>=5.0
commands =
    isort ludo_engine/ examples/ tests/ ludo_interface/ ludo_engine_simple/
    black ludo_engine/ examples/ tests/ ludo_interface/ ludo_engine_simple/
    ruff check ludo_engine/ examples/ tests/ ludo_interface/ ludo_engine_simple/ --fix --ignore E712
    ruff format ludo_engine/ examples/ tests/ ludo_interface/ ludo_engine_simple/